<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.project.subscriptionservice.dao.mapper.SubPlanDaoMapper">
    <resultMap id="subscribe" type="org.project.subscriptionservice.bean.SubscriptionPlanEntity">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="planRef" column="plan_ref"/>
        <result property="description" column="description"/>
        <result property="price" column="price"/>
        <result property="currency" column="currency"/>
        <result property="maxParticipate" column="max_participate"/>
        <result property="billingCycle" column="billing_cycle"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <collection property="subscriptions" ofType="org.project.subscriptionservice.bean.SubscriptionEntity"
                    select="findSubscriptionsByPlanId" column="id"
        />
    </resultMap>
    <resultMap id="subscription" type="org.project.subscriptionservice.bean.SubscriptionEntity">
        <id property="id" column="id"/>
        <result property="planId" column="plan_id"/>
        <result property="status" column="status"/>
        <result property="planStart" column="plan_start"/>
        <result property="planEnd" column="plan_end"/>
        <result property="autoRenew" column="auto_renew"/>
        <result property="isTrial" column="is_trial"/>

        <collection property="members" ofType="org.project.subscriptionservice.bean.SubscriptionMemberEntity"
                    select="findMembersBySubscriptionId" column="id"/>
    </resultMap>
    <resultMap id="member" type="org.project.subscriptionservice.bean.SubscriptionMemberEntity">
        <id property="id" column="id"/>
        <result property="subscriptionId" column="subscription_id"/>
        <result property="userId" column="user_id"/>
        <result property="roleConstant" column="role_status"/>
        <result property="accepted" column="accept"/>
        <result property="invitedAt" column="invited_at"/>

        <association property="userEntity" javaType="org.project.subscriptionservice.bean.UserEntity"
                     select="findUserById" column="user_id"/>
    </resultMap>

    <select id="findSubPlan" resultMap="subscribe" parameterType="int">
        select * from SUBPLANS where id = #{id}
    </select>
    <select id="findSubscriptionsByPlanId" resultMap="subscription" parameterType="int">
        select * from SUBSCRIPTION where PLAN_ID = #{planId}
    </select>
    <select id="findMembersBySubscriptionId" resultMap="member" parameterType="int">
        select * from SUBSCRIPTION_MEMBER where SUBSCRIPTION_ID = #{subscriptionId}
    </select>
    <select id="findUserById" resultType="org.project.subscriptionservice.bean.UserEntity" parameterType="int">
        select * from USERS where id = #{id}
    </select>



</mapper>